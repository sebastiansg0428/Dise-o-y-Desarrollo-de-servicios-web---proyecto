<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Prueba - Crear Entrenador</title>
    <!-- Importar utilidades de pesos colombianos -->
    <script src="/utils-pesos-colombianos.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 20px auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }
      h2 {
        color: #333;
        border-bottom: 2px solid #4caf50;
        padding-bottom: 10px;
      }
      .form-group {
        margin-bottom: 15px;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #555;
      }
      input,
      select,
      textarea {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
      }
      textarea {
        min-height: 80px;
        resize: vertical;
      }
      button {
        background: #4caf50;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        margin-right: 10px;
      }
      button:hover {
        background: #45a049;
      }
      button.secondary {
        background: #2196f3;
      }
      button.secondary:hover {
        background: #0b7dda;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }
      th,
      td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #ddd;
      }
      th {
        background-color: #4caf50;
        color: white;
      }
      tr:hover {
        background-color: #f5f5f5;
      }
      .success {
        background: #d4edda;
        color: #155724;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
      }
      .badge {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
      }
      .badge-activo {
        background: #d4edda;
        color: #155724;
      }
      .badge-inactivo {
        background: #f8d7da;
        color: #721c24;
      }
      pre {
        background: #f4f4f4;
        padding: 10px;
        border-radius: 4px;
        overflow-x: auto;
        font-size: 12px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>üèãÔ∏è Prueba: Crear Entrenador</h2>

      <form id="formCrear">
        <div class="form-group">
          <label>Nombre *</label>
          <input type="text" id="nombre" required value="JACOB" />
        </div>

        <div class="form-group">
          <label>Apellido *</label>
          <input type="text" id="apellido" required value="SANCHEZ" />
        </div>

        <div class="form-group">
          <label>Email *</label>
          <input
            type="email"
            id="email"
            required
            value="jacob.test@gmail.com"
          />
        </div>

        <div class="form-group">
          <label>Tel√©fono</label>
          <input type="tel" id="telefono" value="1234432123" />
        </div>

        <div class="form-group">
          <label>Especialidad</label>
          <select id="especialidad">
            <option value="fuerza">Fuerza</option>
            <option value="hipertrofia" selected>Hipertrofia</option>
            <option value="resistencia">Resistencia</option>
            <option value="cardio">Cardio</option>
            <option value="funcional">Funcional</option>
            <option value="crossfit">Crossfit</option>
            <option value="yoga">Yoga</option>
          </select>
        </div>

        <div class="form-group">
          <label>A√±os de Experiencia</label>
          <input type="number" id="experiencia" value="5" min="0" />
        </div>

        <div class="form-group">
          <label>Tarifa por Rutina (COP) *</label>
          <input
            type="text"
            id="tarifa"
            value="5.000"
            required
            placeholder="Ej: 5.000, 10.000, 50.000"
            onkeyup="formatearInputPesos(event)"
          />
          <small style="color: #666"
            >Ingrese la tarifa en pesos colombianos (sin decimales)</small
          >
          <small id="tarifa-error" style="color: red; display: block"></small>
        </div>

        <div class="form-group">
          <label>Certificaciones</label>
          <input
            type="text"
            id="certificaciones"
            value="NSCA-CPT, ACE"
            placeholder="Ej: NSCA-CPT, ACE"
          />
        </div>

        <div class="form-group">
          <label>Biograf√≠a</label>
          <textarea
            id="biografia"
            placeholder="Describe tu experiencia y especialidades..."
          >
Especialista en hipertrofia y nutrici√≥n deportiva con 5 a√±os de experiencia en entrenamiento personalizado.</textarea
          >
        </div>

        <button type="submit">‚úÖ Crear Entrenador</button>
        <button type="button" class="secondary" onclick="cargarEntrenadores()">
          üîÑ Recargar Lista
        </button>
      </form>

      <div id="mensajes"></div>
    </div>

    <div class="container">
      <h2>üìã Lista de Entrenadores</h2>
      <div id="tablaEntrenadores">
        <p>Cargando...</p>
      </div>
    </div>

    <div class="container">
      <h2>üîç √öltimo Response del Servidor</h2>
      <pre id="responseDebug">Esperando acci√≥n...</pre>
    </div>

    <script>
      const API_URL = "http://localhost:3001";

      // Cargar entrenadores al inicio
      document.addEventListener("DOMContentLoaded", () => {
        cargarEntrenadores();
      });

      // Crear entrenador
      document
        .getElementById("formCrear")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const tarifaInput = document.getElementById("tarifa").value;
          const tarifaNumerica = parsearPesosColombianos(tarifaInput);

          const formData = {
            nombre: document.getElementById("nombre").value,
            apellido: document.getElementById("apellido").value,
            email: document.getElementById("email").value,
            telefono: document.getElementById("telefono").value,
            especialidad_principal:
              document.getElementById("especialidad").value,
            experiencia_anios:
              parseInt(document.getElementById("experiencia").value) || 0,
            tarifa_rutina: tarifaNumerica, // ‚úÖ Enviar como n√∫mero sin formato
            certificaciones: document.getElementById("certificaciones").value,
            biografia: document.getElementById("biografia").value,
          };

          console.log("üì§ Enviando:", formData);
          console.log(
            "üí∞ Tarifa input:",
            tarifaInput,
            "‚Üí Num√©rico:",
            tarifaNumerica
          );
          mostrarMensaje("Creando entrenador...", "info");

          try {
            const response = await fetch(`${API_URL}/entrenadores`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(formData),
            });

            const data = await response.json();
            console.log("üì• Respuesta:", data);

            // Mostrar response completo
            document.getElementById("responseDebug").textContent =
              JSON.stringify(data, null, 2);

            if (data.success) {
              mostrarMensaje(`‚úÖ ${data.message}`, "success");

              // ‚úÖ SOLUCI√ìN: Agregar a la tabla sin recargar
              if (data.entrenador) {
                console.log(
                  "‚úÖ Tarifa recibida:",
                  data.entrenador.tarifa_rutina
                );
                console.log(
                  "‚úÖ Biograf√≠a recibida:",
                  data.entrenador.biografia
                );

                // Recargar lista autom√°ticamente
                setTimeout(() => cargarEntrenadores(), 500);
              }
            } else {
              mostrarMensaje(`‚ùå Error: ${data.message}`, "error");
            }
          } catch (error) {
            console.error("‚ùå Error:", error);
            mostrarMensaje(`‚ùå Error de conexi√≥n: ${error.message}`, "error");
          }
        });

      // Cargar lista de entrenadores
      async function cargarEntrenadores() {
        try {
          const response = await fetch(`${API_URL}/entrenadores`);
          const entrenadores = await response.json();

          console.log("üìã Entrenadores cargados:", entrenadores.length);

          let html = `
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nombre</th>
                                <th>Email</th>
                                <th>Especialidad</th>
                                <th>Experiencia</th>
                                <th>Tarifa</th>
                                <th>Biograf√≠a</th>
                                <th>Clientes</th>
                                <th>Rating</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

          entrenadores.forEach((e) => {
            // ‚úÖ Formatear tarifa en pesos colombianos
            const tarifa = formatearPesosColombianos(e.tarifa_rutina || 0);
            const biografia = e.biografia || "<em>Sin biograf√≠a</em>";
            const biografiaCorta =
              biografia.length > 50
                ? biografia.substring(0, 50) + "..."
                : biografia;

            html += `
                        <tr>
                            <td>${e.id}</td>
                            <td><strong>${e.nombre} ${
              e.apellido || ""
            }</strong></td>
                            <td>${e.email}</td>
                            <td>${e.especialidad_principal}</td>
                            <td>${e.experiencia_anios} a√±os</td>
                            <td><strong>${tarifa}</strong></td>
                            <td title="${biografia}">${biografiaCorta}</td>
                            <td>${e.total_clientes || 0}</td>
                            <td>‚≠ê ${parseFloat(
                              e.promedio_puntuacion || 0
                            ).toFixed(1)}</td>
                            <td><span class="badge badge-${e.estado}">${
              e.estado
            }</span></td>
                        </tr>
                    `;
          });

          html += `
                        </tbody>
                    </table>
                    <p style="margin-top: 10px; color: #666;">
                        Total: <strong>${entrenadores.length}</strong> entrenadores
                    </p>
                `;

          document.getElementById("tablaEntrenadores").innerHTML = html;
        } catch (error) {
          console.error("Error al cargar entrenadores:", error);
          document.getElementById(
            "tablaEntrenadores"
          ).innerHTML = `<p class="error">‚ùå Error al cargar entrenadores: ${error.message}</p>`;
        }
      }

      function mostrarMensaje(texto, tipo) {
        const div = document.getElementById("mensajes");
        div.innerHTML = `<div class="${tipo}">${texto}</div>`;
        setTimeout(() => {
          div.innerHTML = "";
        }, 5000);
      }
    </script>
  </body>
</html>
